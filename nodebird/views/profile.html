{% extends 'layout.html' %}

{% block content %}
  <div class="timeline">
    <div class="user-name">
      <h2>Profile</h2>    
      <div class="half">    
        <h4>Email/ID</h4> 
        {{user.email}}
      </div>
      <div class="half">    
        <h4>Nickname</h4> 
        {{user.nick}}
        <button class="nick-change">chanege</button>
      </div>
  </div>
    <!-- <div class="followings half">
      <h2>íŒ”ë¡œì‰ ëª©ë¡</h2>
      {% if user.Followings %}
        {% for following in user.Followings %}
        <div>
          {{following.nick}}
          <input type="hidden" value="{{following.id}}" class="following-id">
          <button class="twit-unfollow">ì–¸íŒ”ë¡œìš°í•˜ê¸°</button>
        </div>
        {% endfor %}
      {% endif %}
    </div> -->
    <div class="followers half">
      <h2>Materials</h2>
      {% if user.Followers %}
        {% for follower in user.Followers %}
          <!-- <div>íŒ”ë¡œì‰-{{follower.nick}}</div> -->
        {% endfor %}
      {% endif %}
      <div>
        <strong style="font-size: 15pt; color: crimson;">ì˜ì</strong>
        <span style="font-size: 15pt;">3</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">í‚¤ë³´ë“œ</strong>
        <span style="font-size: 15pt;">6</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">ì±…ìƒ</strong>
        <span style="font-size: 15pt;">5</span>
      </div>
    </div>
    <div class="followers half">
      <h2>Others</h2>
      {% if user.Followers %}
        {% for follower in user.Followers %}
          <div><strong style="font-size: 20pt; color: crimson;">Following - {{follower.nick}}</strong></div>
        {% endfor %}
      {% endif %}
      <div>
        <strong style="font-size: 15pt; color: crimson;">ë°°í„°ë¦¬</strong>
        <span style="font-size: 15pt;">10</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">í…Œì´í”„</strong>
        <span style="font-size: 15pt;">10</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">ì´ì–´í° 2</strong>
        <span style="font-size: 15pt;">5</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">ì´ì–´í° 1</strong>
        <span style="font-size: 15pt;">5</span>
      </div>
      <div>
        <strong style="font-size: 15pt; color: crimson;">ì—ì–´íŒŸ</strong>
        <span style="font-size: 15pt;">3</span>
      </div>
    </div>
    <button class="homebtn" onclick="location.href='/'" >ğŸ </button>
  </div>
{% endblock %}

{% block script %}
  <script>
    document.querySelectorAll('.twit-unfollow').forEach(function(tag) {
      tag.addEventListener('click', function() {
        const myId = document.querySelector('#my-id');
        if (myId) {
          const userId = tag.parentNode.querySelector('.following-id').value;
          if (userId !== myId.value) {
            if (confirm('ì–¸íŒ”ë¡œìš°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              axios.delete(`/user/${userId}/unfollow`)
                .then(() => {
                  location.reload();
                })
                .catch((err) => {
                  console.error(err);
                });
            }
          }
        }
      });
    });
    document.querySelectorAll('.nick-change').forEach(function(tag) {
      tag.addEventListener('click', function() {
        const myId = document.querySelector('#my-id');
        if (myId) {
          const userNick = document.querySelector('#my-nick');
          const newNick = prompt("ìƒˆë¡œìš´ ë‹‰ë„¤ì„ì„ ì•Œë ¤ì£¼ì„¸ìš”")
          if (newNick !== userNick) {
            if (confirm(`ë‹‰ë„¤ì„ì„ ${newNick}(ìœ¼)ë¡œ ë³€ê²½í• ê¹Œìš”?`)) {
              encoded = encodeURIComponent(newNick);
              console.log(encoded)
              axios.patch(`/user`,{newNick:encoded})
                .then(() => {
                  location.reload();
                })
                .catch((err) => {
                  console.error(err);
                });
            }
          }
        }
      });
    });
  </script>
{% endblock %}